#include "SerialTransfer.h"
#include <SoftwareSerial.h>


SerialTransfer myTransfer;

char arr[6];
//char data[6];
unsigned long distance;

void setup()
{
  Serial.begin(9600);
	while(!Serial){
		// serial transfer via uart needs to wait
	}
  Serial1.begin(9600);

	myTransfer.begin(Serial1);


	// Setup esp8266 wifi connection
	/* WiFi.begin(ssid, password);             // Connect to the network */
  /* Serial.print("Connecting to "); */
  /* Serial.print(ssid); Serial.println(" ..."); */

  /* int i = 0; */
  /* while (WiFi.status() != WL_CONNECTED) { // Wait for the Wi-Fi to connect */
  /*   delay(1000); */
  /*   Serial.print(++i); Serial.print(' '); */
  /* } */

  /* Serial.println('\n'); */
  /* Serial.println("Connection established!");   */
  /* Serial.print("IP address:\t"); */
  /* Serial.println(WiFi.localIP());         // Send the IP address of the ESP8266 to the computer */

}


void loop()
{
	Serial.println("looping");
  if(myTransfer.available())
  {
    // use this variable to keep track of how many
    // bytes we've processed from the receive buffer
    uint16_t recSize = 0;

		recSize = myTransfer.rxObj(data, recSize);
    Serial.println(distance);
		Serial.print("number of bytes processed from RXbuffer, recSise=");
		Serial.println(recSize);
		//Serial.println("xfer available");


		/* // Send SMS with level sensor value via ifttt server. */
		/* WiFiClient client; */

		/* // connect to the Maker event server */
		/* const char* apiKey = "ptJbZEpqEFQaB5ZwcLwwBBAJ6KhmVoqpiGvrxModLOp"; */
		/* String makerEvent = "tank_level"; */
		/* const char* server = "maker.ifttt.com"; */
		/* const int httpPort = 80; */
	 
		/* if (!client.connect(server, httpPort)){ */
		/* 	Serial.println("Connection failed to ifttt server"); */
		/* 	return; */
		/* } */
		/* else{ */
		/* 	Serial.println("Connected to ifttt server"); */
		/* } */
	 

		/* /// WORKS: */
		/* //char data[] = "value1=101"; */
		/* //no wrks: string data = "value1=101"; */
		/* String data = "value1=0"; */
		/* int value = 42; */
		/* String value2str = String(value); */
		/* data = data + value2str; */

		/* Serial.print("Sending data value to ifttt server, data="); */
		/* Serial.println(data); */

		/* String url = "/trigger/" + makerEvent + "/with/key/"; */
		/* url += apiKey; */
                                                                                     
		/* client.println(String("POST ") + url + " HTTP/1.1"); */
		/* client.println(String("Host: ") + server); */
		/* client.println(String("Content-Type: application/x-www-form-urlencoded")); */
		/* client.print(String("Content-Length: ")); */
		/* client.println(sizeof(data)); */
		/* client.println(); */
		/* client.println(data); */

		/* //delay(10000); */
		/* client.stop(); */

  }

}
